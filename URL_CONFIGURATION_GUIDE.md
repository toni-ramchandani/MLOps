# URL & Configuration Reference Guide

## üìç Where to Find and Access Service URLs

### üåê Service Access Points

| Service | Local URL | File Locations | How to Access |
|---------|-----------|-----------------|---------------|
| **API** | http://localhost:8000 | `infra/docker/docker-compose.yml:18` | `curl http://localhost:8000/health` |
| **API Documentation** | http://localhost:8000/docs | Auto-generated by FastAPI | Browser: Click link above |
| **MLflow UI** | http://localhost:5000 | `infra/docker/docker-compose.yml:31` | Browser or `curl http://localhost:5000` |
| **Prometheus** | http://localhost:9090 | `infra/docker/docker-compose.yml:76` | Browser or `curl http://localhost:9090` |
| **Grafana** | http://localhost:3000 | `infra/docker/docker-compose.yml:92` | Browser (admin/admin) |
| **PostgreSQL** | localhost:5432 | `infra/docker/docker-compose.yml:52` | `psql -h localhost -U mlops_user -d mlflow` |

---

## üìÇ Configuration Files Containing URLs

### 1Ô∏è‚É£ **Docker Compose Configuration**
**File**: [infra/docker/docker-compose.yml](infra/docker/docker-compose.yml)

```yaml
# Line 18-22: API Service
api:
  ports:
    - "8000:8000"      # Maps host:container

# Line 31-37: MLflow Service  
mlflow:
  ports:
    - "5000:5000"      # MLflow UI port

# Line 52-55: PostgreSQL Service
postgres:
  ports:
    - "5432:5432"      # Database port

# Line 76-81: Prometheus
prometheus:
  ports:
    - "9090:9090"      # Metrics port

# Line 92-99: Grafana
grafana:
  ports:
    - "3000:3000"      # Dashboard port
```

**How to modify**: Edit port numbers or environment variables directly

---

### 2Ô∏è‚É£ **Environment Configuration**
**File**: [infra/docker/.env.example](infra/docker/.env.example)

```env
# MLflow Configuration (Lines 8-9)
MLFLOW_TRACKING_URI=http://mlflow:5000
MLFLOW_REGISTRY_URI=http://mlflow:5000

# Port Configuration (Lines 24-26)
API_PORT=8000
MLflow_PORT=5000
```

**How to use**: 
```bash
cp infra/docker/.env.example infra/docker/.env
# Edit .env with your settings
docker-compose --env-file .env up
```

---

### 3Ô∏è‚É£ **Application Configuration**
**File**: [configs/config.yaml](configs/config.yaml)

```yaml
# Line 16: MLflow Configuration
mlflow:
  tracking_uri: "sqlite:///mlflow.db"
  experiment_name: "enterprise_demo"
  registered_model_name: "breast_cancer_enterprise_lr"
```

**For Docker**: Override with environment variable in `docker-compose.yml`
```yaml
environment:
  - MLFLOW_TRACKING_URI=http://mlflow:5000
```

---

### 4Ô∏è‚É£ **Settings Module**
**File**: [src/mlops_enterprise/settings.py](src/mlops_enterprise/settings.py)

```python
# Line 15-17: MLflow URI resolution
@property
def mlflow_tracking_uri(self) -> str:
    return os.getenv("MLFLOW_TRACKING_URI", self.config["mlflow"]["tracking_uri"])
```

**Priority order**:
1. Environment variable: `MLFLOW_TRACKING_URI`
2. Config file: `configs/config.yaml`
3. Default: SQLite database

---

### 5Ô∏è‚É£ **Prometheus Scraping**
**File**: [infra/docker/prometheus.yml](infra/docker/prometheus.yml)

```yaml
# Line 17: Prometheus itself
static_configs:
  - targets: ['localhost:9090']

# Line 23: API metrics endpoint
static_configs:
  - targets: ['api:8000']

# Line 27: MLflow metrics
static_configs:
  - targets: ['mlflow:5000']
```

---

### 6Ô∏è‚É£ **Validation Script**
**File**: [infra/docker/validate.sh](infra/docker/validate.sh)

```bash
# Line 7: API URL definition
API_URL="http://localhost:8000"
```

---

### 7Ô∏è‚É£ **Documentation URLs**
**Files with URL references**:

| File | Purpose | Key Lines |
|------|---------|-----------|
| [DEPLOYMENT.md](DEPLOYMENT.md) | Deployment guide | Lines 31-43 |
| [README_ENTERPRISE.md](README_ENTERPRISE.md) | Quick reference | Lines 31-48 |
| [Makefile](Makefile) | Development commands | Lines 37-39 |

---

## üîß How to Change URLs

### **Scenario 1: Change API Port (8000 ‚Üí 9000)**

1. **Docker Compose**:
   ```yaml
   # infra/docker/docker-compose.yml - Line 18
   ports:
     - "9000:8000"  # Changed from 8000:8000
   ```

2. **Prometheus Config**:
   ```yaml
   # infra/docker/prometheus.yml - Line 23
   - targets: ['api:9000']
   ```

3. **Validation Script**:
   ```bash
   # infra/docker/validate.sh - Line 7
   API_URL="http://localhost:9000"
   ```

### **Scenario 2: Change MLflow URL (localhost ‚Üí mlops.example.com)**

1. **Environment File**:
   ```env
   # infra/docker/.env
   MLFLOW_TRACKING_URI=http://mlops.example.com:5000
   MLFLOW_REGISTRY_URI=http://mlops.example.com:5000
   ```

2. **Application Config** (if needed):
   ```yaml
   # configs/config.yaml
   mlflow:
     tracking_uri: "http://mlops.example.com:5000"
   ```

### **Scenario 3: Change Database Connection (SQLite ‚Üí PostgreSQL)**

1. **Config File**:
   ```yaml
   # configs/config.yaml
   mlflow:
     tracking_uri: "postgresql://mlops_user:mlops_password@postgres:5432/mlflow"
   ```

2. **Docker Compose** (already done):
   ```yaml
   # infra/docker/docker-compose.yml
   depends_on:
     postgres:
       condition: service_healthy
   ```

---

## üîç How to Access URLs from Code

### **In Python Application**:
```python
# src/mlops_enterprise/settings.py
from .settings import load_settings

settings = load_settings("configs/config.yaml")
mlflow_uri = settings.mlflow_tracking_uri
# Returns: "http://mlflow:5000" (from Docker) or env var
```

### **In FastAPI**:
```python
# src/mlops_enterprise/api.py
import mlflow
from .settings import load_settings

s = load_settings("configs/config.yaml")
mlflow.set_tracking_uri(s.mlflow_tracking_uri)
```

### **In Shell Scripts**:
```bash
# infra/docker/validate.sh
curl -s "$API_URL$HEALTH_ENDPOINT"
```

---

## üì° API Endpoints

### **Available Endpoints**:
```
GET  /health              # Health check
GET  /metrics             # Prometheus metrics
POST /predict             # Make predictions
GET  /docs                # Swagger UI
GET  /openapi.json        # OpenAPI schema
```

**Access from code**:
```python
# Using httpx or requests
client = TestClient(app)
response = client.get("/health")
print(response.json())  # {"status": "ready", ...}
```

---

## üåç Network Architecture

### **Docker Internal Network**:
```
mlops-network (internal bridge network)
‚îú‚îÄ‚îÄ api         (http://api:8000 internally)
‚îú‚îÄ‚îÄ mlflow      (http://mlflow:5000 internally)
‚îú‚îÄ‚îÄ postgres    (postgres:5432 internally)
‚îú‚îÄ‚îÄ prometheus  (http://prometheus:9090 internally)
‚îî‚îÄ‚îÄ grafana     (http://grafana:3000 internally)
```

### **External Access** (from host):
```
localhost:8000     ‚Üí api:8000
localhost:5000     ‚Üí mlflow:5000
localhost:5432     ‚Üí postgres:5432
localhost:9090     ‚Üí prometheus:9090
localhost:3000     ‚Üí grafana:3000
```

---

## üîê Credentials & Access

### **Default Credentials**:
| Service | Username | Password |
|---------|----------|----------|
| Grafana | admin | admin |
| PostgreSQL | mlops_user | mlops_password |
| MLflow | (none) | (none) |
| API | (none) | (none) |

**Location**: [infra/docker/docker-compose.yml](infra/docker/docker-compose.yml) and [infra/docker/.env.example](infra/docker/.env.example)

---

## üìä Testing URLs

### **Using curl**:
```bash
# Health check
curl http://localhost:8000/health

# Metrics
curl http://localhost:8000/metrics

# Prediction
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{"rows": [{"feature1": 1.0}]}'
```

### **Using Python**:
```python
import requests

response = requests.get("http://localhost:8000/health")
print(response.json())
```

### **Using validation script**:
```bash
cd infra/docker
./validate.sh
```

---

## üîó Quick Reference Commands

```bash
# Start services
cd infra/docker && docker-compose up -d --build

# Check running services
docker-compose ps

# View logs
docker-compose logs -f api

# Test API health
curl http://localhost:8000/health

# Access services
open http://localhost:8000/docs         # API docs
open http://localhost:5000              # MLflow
open http://localhost:3000              # Grafana
open http://localhost:9090              # Prometheus
```

---

## üìù Environment Variables

### **Supported Variables**:
```bash
# MLflow
MLFLOW_TRACKING_URI          # Tracking server URL
MLFLOW_REGISTRY_URI          # Registry server URL

# Database
POSTGRES_USER                # DB username
POSTGRES_PASSWORD            # DB password
POSTGRES_DB                  # DB name

# Grafana
GF_SECURITY_ADMIN_PASSWORD   # Grafana admin password
GF_SECURITY_ADMIN_USER       # Grafana admin username

# Logging
LOG_LEVEL                    # Application log level
PYTHONUNBUFFERED             # Python output buffering
```

**Set in**: `infra/docker/.env` or `docker-compose.yml`

---

## ‚úÖ Verification Checklist

- [ ] Read [DEPLOYMENT.md](DEPLOYMENT.md) for setup
- [ ] Review [infra/docker/docker-compose.yml](infra/docker/docker-compose.yml)
- [ ] Check [configs/config.yaml](configs/config.yaml) for app config
- [ ] Review [src/mlops_enterprise/settings.py](src/mlops_enterprise/settings.py) for URL resolution
- [ ] Run `make validate` or `./infra/docker/validate.sh`
- [ ] Test endpoints with `curl` commands
- [ ] Access all UIs in browser

---

**All URLs, ports, and configurations are centralized in these files. Modify them as needed for your environment!** üöÄ
